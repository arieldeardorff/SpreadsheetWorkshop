<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Designing Reproducible Spreadsheets</title>
    <meta charset="utf-8" />
    <meta name="author" content="Ariel Deardorff, MLIS   Data Services Librarian   UCSF Library" />
    <meta name="date" content="2021-02-10" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: left, middle, inverse, title-slide

# Designing Reproducible Spreadsheets
### Ariel Deardorff, MLIS <br> Data Services Librarian <br> UCSF Library
### 2021-02-10

---




class: center, middle

# Welcome

---

# Learning Objectives 

By the end of this workshop you should be able to:

* Describe best practices for reproducible data organization in spreadsheets
* Design tidy spreadsheets that can be used in a wide variety of data analysis software

---

Our goal today is to talk about how we can turn this:

&lt;br&gt;
--

&lt;img src="Images/SpreadsheetBefore.png" width="75%" /&gt;

--

Into this:

--

![Image of Messy spreadsheet](Images/SpreadsheetAfter.png)

---

class: left, middle

## But first, let's hear from you!

---

# Why should I care about spreadsheets?

Spreadsheets are everywhere! 

--

Terrible spreadsheets are everywhere too! 

---

## Messy spreadsheets can have real consequences

--

&lt;br&gt;

![Image of Covid Excel Counting headline](Images/ExcelHeadline.png)

&lt;br&gt;

???
Case study of the British Government 
- Also can't properly load your data into software tools if it isnt formatted properly (Tableau, OpenRefine, SPSS, Python)

---

class: left, middle

## Thankfully there are some simple steps we can take to make our spreadsheets understandable &amp; reproducible!

---

# Spreadsheets as part of a reproducible pipeline

* Use spreadsheets for data entry and data storage
* Once data has been collected it is time to move on to another tool for data analysis and visualization (like R, Python, SAS, STATA, or Tableau)
* Data analysis in spreadsheets is messy, fraught with errors, and not easily reproduced

---

# How should my spreadsheets be structured?

--

Follow the principles of **Tidy Data!**

.pull-left[

In Tidy Data:
- Each variable forms a column
- Each observation forms a row
- Each cell is a single measurement]

.pull-right[![tidy data image](Images/TidyDataBasic.png)]

Source: [Wickham, 2014](https://www.jstatsoft.org/article/view/v059i10)

---
class: left

Tidy Data

![tidy data image](Images/TidyDataBasic.png)

--

Not Tidy Data

.pull-left[


![messy data image](Images/NotTidyDataOne.png)

Source: [Wickham, 2014](https://www.jstatsoft.org/article/view/v059i10)]

.pull-right[

![messy data image](Images/NotTidyDataTwo.png)

]

---

## Tidy vs Messy Data

![Tidy vs Messy Data](Images/TidyvsMessy.png)
Source: [Lowndes &amp; Horst, 2020](https://docs.google.com/presentation/d/1N7hKepabvl9OrHjvGJWPjUsfzVdB5xzV5AsFndgSwms/edit#slide=id.p)

---

# Activity 1 - Tidy that Data!

How should we re-arrange this data to make it Tidy? 

Share your ideas in the etherpad!

![Messy Data Screenshot](Images/ActivityNotTidy.png)


---

class: left, middle

## Once we have our structure down, it is time to look at your values and variables

---

## What names should I use?

Make those variable (and file) names descriptive!

.pull-left[
![Good variable names](Images/VariableNameGood.png)
]

.pull-right[
![Bad variable names](Images/VariableNameBad.png)
]

source: [Broman &amp; Woo, 2017](https://www.tandfonline.com/doi/full/10.1080/00031305.2017.1375989)
---

File names matter too!

![](Images/FileNaming.png)&lt;!-- --&gt;
source: [Briney, Coates, &amp; Goben, 2020](https://riojournal.com/article/56508/instance/5569704/)

---

## Dates

Did you know there is an international standard for dates (ISO 8601)?

### .center[YYYY-MM-DD]

Note that Excel can get real funky with dates!

You can get around this by:
* Changing your dates to text values rather than dates
* Separating your dates into columns for year, month, and day

---

## Null/Missing Values

Be precise about whether data is missing or has a value of zero

If data has a value of zero, write in a 0

If data is missing, indicate with NA/NULL

---

## Avoid formatting in Excel

Excel can make things beautiful but don't use formatting to add data to your spreadsheet.

Don't use formatting to encode meaning (highlighted/bolded cells to indicate something). Add this information in a new cell/column

---

## Create a data dictionary!

![Data Dictionary](Images/DataDictionaryExample_Broman.png)

source: [Broman &amp; Woo, 2017](https://www.tandfonline.com/doi/full/10.1080/00031305.2017.1375989)

---

# Activity 2: Critique a messy data spreadsheet

You will have 10 minutes in breakout rooms to critique [a messy spreadsheet of COVID data](https://github.com/arieldeardorff/SpreadsheetWorkshop/raw/master/COVIDData_Messy.xlsx) 
* What spreadsheet errors do you see?
* How would you design it differently?

Note that this is real COVID data from Carbon Health that has been messed up for our class.

Share your ideas in the etherpad and we will discuss as a group.

---

# What else can I do to keep my spreadsheets reproducible?

* Consider using data validation features in Excel during data entry
* Save as a plain text file (CSV)
* Create a backup copy!

---

# How do I fix existing messy spreadsheets?
Here are some tools and tutorials you can use if you need to clean up already messy spreadsheets:

* OpenRefine - [tool](https://openrefine.org/), [tutorial](https://arieldeardorff.github.io/OpenRefineWorkshop/index.html) (open source data cleaning software)
* R Tidyverse - [tool](https://www.tidyverse.org/), [tutorial](https://rstudio-conf-2020.github.io/r-for-excel/) (R package for cleaning spreadsheet data)
* Python Pandas - [tool](https://pandas.pydata.org/), [tutorial](https://courses.ucsf.edu/course/view.php?id=5248) 

---

# Learn More

Check out these articles to learn more about tidy data or organizing data in spreadsheets:

Briney KA, Coates H, Goben A (2020) Foundational Practices of Research Data Management. Research Ideas and Outcomes 6: e56508. [https://doi.org/10.3897/rio.6.e56508](https://doi.org/10.3897/rio.6.e56508)

Broman, K. &amp; Woo, K (2018) Data Organization in Spreadsheets, The American Statistician, 72:1, 2-10, DOI: [10.1080/00031305.2017.1375989](https://www.tandfonline.com/doi/full/10.1080/00031305.2017.1375989) 

Wickham, H. (2014). Tidy Data. Journal of Statistical Software, 59(10), 1 - 23. doi:[http://dx.doi.org/10.18637/jss.v059.i10](http://dx.doi.org/10.18637/jss.v059.i10)

---

class: left, middle

# What Questions Do You Have?

---

# References

Briney KA, Coates H, Goben A (2020) Foundational Practices of Research Data Management. Research Ideas and Outcomes 6: e56508. [https://doi.org/10.3897/rio.6.e56508](https://doi.org/10.3897/rio.6.e56508)

Broman, K. &amp; Woo, K (2018) Data Organization in Spreadsheets, The American Statistician, 72:1, 2-10, DOI: [10.1080/00031305.2017.1375989](https://www.tandfonline.com/doi/full/10.1080/00031305.2017.1375989) 

Carbon Health and Braid Data. (2020) Coronavirus Disease 2019 (COVID-19) Clinical Data Repository. Accessed from [https://covidclinicaldata.org/](https://covidclinicaldata.org/) 

Lowndes, J. &amp; Horst, A. (2020) Tidy Data for Efficiency, Reproducibility, and Collaboration. OpenScapes [https://www.openscapes.org/blog/2020/10/12/tidy-data/](https://www.openscapes.org/blog/2020/10/12/tidy-data/)

Sherry Lake, Tim Dennis, Jez Cope, Francois Michonneau, Christopher Erdmann, erikamias, â€¦ yvonnemery. (2020, July). LibraryCarpentry/lc-spreadsheets: LibraryCarpentry/lc-spreadsheets: Library Carpentry: Tidy data for Librarians, July 2020 (Version v2020.07.1). Zenodo. [http://doi.org/10.5281/zenodo.3954067](http://doi.org/10.5281/zenodo.3954067)

Wickham, H. (2014). Tidy Data. Journal of Statistical Software, 59(10), 1 - 23. doi:[http://dx.doi.org/10.18637/jss.v059.i10](http://dx.doi.org/10.18637/jss.v059.i10)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create();
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
